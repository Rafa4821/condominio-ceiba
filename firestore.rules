rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regla de seguridad base: Solo permite el acceso a usuarios autenticados.
    // Esto es un punto de partida. En una aplicación real, se necesitarían
    // reglas más granulares para asegurar que un usuario solo pueda acceder
    // a los datos de su propio edificio (multi-tenancy).
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Ejemplo de regla más específica (a implementar en el futuro):
    // match /buildings/{buildingId} {
    //   allow read: if request.auth != null;
    //   allow write: if request.auth.uid == resource.data.adminUid; // Solo el admin del edificio
    // }

    // match /units/{unitId} {
    //   // Solo usuarios asociados al edificio pueden leer unidades
    //   allow read: if request.auth != null && get(/databases/$(database)/documents/buildings/$(resource.data.buildingId)).data.members[request.auth.uid] != null;
    //   // Solo el admin puede escribir
    //   allow write: if request.auth != null && get(/databases/$(database)/documents/buildings/$(resource.data.buildingId)).data.adminUid == request.auth.uid;
    // }
  }
}
